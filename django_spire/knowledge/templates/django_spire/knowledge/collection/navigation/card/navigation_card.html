{% extends 'django_spire/card/title_card.html' %}

{% block card_title %}
	Collections
{% endblock %}

{% block card_button %}
    {% if AuthController.knowledge.can_add %}
        {% url 'django_spire:knowledge:collection:form:create' as create_url %}
        {% include 'django_spire/button/primary_button.html' with button_text='Add' button_href=create_url button_icon="bi bi-plus" %}
    {% endif %}
{% endblock %}

{% block card_title_content %}
    <div
        x-data="{
            show_context_menu: false,
            x: 0,
            y: 0,
            focused_object: {},
            focused_type: '',
            title: '',

            show_menu({event, type, object}) {
                this.x = event.pageX
                this.y = event.pageY
                this.focused_type = type
                this.focused_object = object
                this.title = this.focused_object.name
                this.show_context_menu = true
            },
            hide_menu() {
                this.show_context_menu = false
                this.focused_object = {}
            },

            {% if AuthController.knowledge.can_view %}
            view_entry() {
                window.location.href = this.focused_object.view_url
            },
            {% endif %}

            {% if AuthController.knowledge.can_change %}
            edit_entry() {
                window.location.href = this.focused_object.edit_url
            },
            {% endif %}

            {% if AuthController.knowledge.can_delete %}
            delete_entry() {
                window.location.href = this.focused_object.delete_url
            },
            delete_collection() {
                window.location.href = this.focused_object.delete_url
            },
            {% endif %}

            {% if AuthController.knowledge.can_add %}
            import_entry() {
                window.location.href = this.focused_object.import_entry_url
            },
            add_entry() {
                window.location.href = this.focused_object.create_entry_url
            },
            {% endif %}
        }"
        @click.away="hide_menu()"
        @contextmenu.prevent=""
        class="user-select-none"
    >
        {% include 'django_spire/knowledge/collection/component/x_collection_navigation.html' %}
        {% include 'django_spire/knowledge/collection/card/context_menu_card.html' %}
        {% include 'django_spire/knowledge/entry/card/context_menu_card.html' %}

        <x-collection-navigation :data="{items: manager.collection_map, id: null}"></x-collection-navigation>
    </div>
{% endblock %}
