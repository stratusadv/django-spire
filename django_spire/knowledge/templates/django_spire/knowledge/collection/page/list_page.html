{% extends 'django_spire/page/full_page.html' %}

{% load static %}

{% block base_body_additional_top_js %}
    <script type="application/javascript" src="{% static 'django_spire/knowledge/collection/js/managers.js' %}?v={{ DJANGO_SPIRE_VERSION }}"></script>
{% endblock %}

{% block base_body_additional_bottom_js %}
    <script type="application/javascript" src="{% static 'django_spire/knowledge/collection/js/x_component.js' %}?v={{ DJANGO_SPIRE_VERSION }}"></script>
{% endblock %}

{% block full_page_content %}
    <div class="row">
        <div class="col-12">
            <div
                x-data="{
                    manager: new CollectionManager({{ collection_tree_json }}),

                    is_dragging: false,

                    toggle_dragging(value) {
                        this.is_dragging = value
                    },

                    async move_collection({collection, order, new_parent}) {
                        let response = null
                        try {
                            response = await django_glue_fetch(
                                '{% url "django_spire:knowledge:collection:json:reorder" %}',
                                {payload: {collection_id: collection.id, order: order, parent: new_parent}}
                            )
                        } catch (e) {
                             $dispatch('notify', {'type': 'error', 'message': 'An unexpected error has occured. Please refresh the page and try again.'})
                        }

                        if (response.type === 'error') {
                            $dispatch('notify', {'type': response.type, 'message': response.message})
                        }
                    },

                    async move_entry({entry, collection, order}) {
                        let response = null
                        try {
                            response = await django_glue_fetch(
                                '{% url "django_spire:knowledge:entry:json:reorder" %}',
                                {payload: {entry_id: entry.entry_id, order: order, collection_id: collection.id}}
                            )
                        } catch (e) {
                             $dispatch('notify', {'type': 'error', 'message': 'An unexpected error has occured. Please refresh the page and try again.'})
                        }

                        if (response.type === 'error') {
                            $dispatch('notify', {'type': response.type, 'message': response.message})
                        }
                    }
                }"
                x-sort:config="{handle: '[x-sort\\:handle]'}"
                >
                    {% include 'django_spire\knowledge\collection\navigation\card\navigation_card.html' %}
            </div>
        </div>
    </div>
{% endblock %}
