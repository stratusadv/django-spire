<div
    x-data
    x-init="
        Alpine.store('theme', {
            available: [
                { name: 'Catppuccin Light', value: 'catppuccin-light', family: 'catppuccin', mode: 'light' },
                { name: 'Catppuccin Dark', value: 'catppuccin-dark', family: 'catppuccin', mode: 'dark' },
                { name: 'Dracula Light', value: 'dracula-light', family: 'dracula', mode: 'light' },
                { name: 'Dracula Dark', value: 'dracula-dark', family: 'dracula', mode: 'dark' },
                { name: 'Gruvbox Light', value: 'gruvbox-light', family: 'gruvbox', mode: 'light' },
                { name: 'Gruvbox Dark', value: 'gruvbox-dark', family: 'gruvbox', mode: 'dark' },
                { name: 'Material Light', value: 'material-light', family: 'material', mode: 'light' },
                { name: 'Material Dark', value: 'material-dark', family: 'material', mode: 'dark' },
                { name: 'Nord Light', value: 'nord-light', family: 'nord', mode: 'light' },
                { name: 'Nord Dark', value: 'nord-dark', family: 'nord', mode: 'dark' },
                { name: 'Rose Pine Light', value: 'rose-pine-light', family: 'rose-pine', mode: 'light' },
                { name: 'Rose Pine Dark', value: 'rose-pine-dark', family: 'rose-pine', mode: 'dark' }
            ],

            current: localStorage.getItem('django-spire-theme') || 'rose-pine-light',

            get_current_theme() {
                return this.available.find(theme => theme.value === this.current) || this.available[0];
            },

            apply() {
                let theme = this.get_current_theme();

                if (theme.mode === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }

                this.load_theme_css(theme.family, theme.mode);
            },

            load_theme_css(family, mode) {
                let existing_link = document.querySelector('link[data-theme-css]');

                if (existing_link) {
                    existing_link.remove();
                }

                let link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = `/static/django_spire/css/themes/${family}/app-${mode}.css`;
                link.setAttribute('data-theme-css', 'true');

                document.head.appendChild(link);
            },

            toggle() {
                let current_theme = this.get_current_theme();
                let new_mode = current_theme.mode === 'dark' ? 'light' : 'dark';
                let new_theme_value = `${current_theme.family}-${new_mode}`;

                let new_theme = this.available.find(t => t.value === new_theme_value);

                if (new_theme) {
                    this.set(new_theme.value);
                }
            },

            set(theme_value) {
                this.current = theme_value;
                this.apply();
                localStorage.setItem('django-spire-theme', theme_value);
            },

            is(theme_value) {
                return this.current === theme_value;
            },

            is_mode(mode) {
                return this.get_current_theme().mode === mode;
            },

            get_theme_name() {
                return this.get_current_theme().name;
            }
        });

        $store.theme.apply();
    "
>
</div>
