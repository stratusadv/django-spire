<div
    class="{% if not is_last %}border-bottom{% endif %} py-1"
    data-row-id="{{ row.pk }}"
    x-data="{
        row_id: '{{ row.pk }}',
        is_open: false,
        has_children: true,

        handle_toggle_row_state(event) {
            if (event.detail.row_id === this.row_id) {
                this.is_open = event.detail.is_open;
            }
        }
    }"
    @toggle-row-state.window="handle_toggle_row_state($event)"
>
    <div class="d-flex align-items-center gap-2">
        <template x-if="has_children">
            <i
                :class="is_open ? 'bi-chevron-down' : 'bi-chevron-right'"
                @click="$dispatch('toggle-row', { row_id: row_id })"
                class="bi cursor-pointer text-primary"
            ></i>
        </template>

        <span>{{ row.task.name }} - ${{ row.calculated_cost|floatformat:2 }}</span>
    </div>

    <div class="ms-4 mt-2" x-show="is_open" x-cloak>
        {% url 'tabular:template:task_detail_rows' task_id=row.task.pk as child_endpoint %}
        {% include 'django_spire/table/element/child_row.html' with child_endpoint=child_endpoint %}
    </div>
</div>
